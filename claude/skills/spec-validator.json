{
  "name": "spec-validator",
  "version": "1.0.0",
  "description": "Validates NodeID specification completeness and quality. Checks for required sections, testable ARC criteria, placeholder text, and structural integrity.",
  "parameters": [
    {
      "name": "spec_path",
      "type": "string",
      "required": true,
      "description": "Absolute path to the spec file to validate"
    },
    {
      "name": "node_id",
      "type": "string",
      "required": true,
      "description": "NodeID being validated (for error reporting)"
    }
  ],
  "actions": [
    {
      "type": "python",
      "code": "from pathlib import Path\nimport re\n\nspec_path = Path(inputs['spec_path'])\nnode_id = inputs['node_id']\n\nif not spec_path.exists():\n    outputs['valid'] = False\n    outputs['errors'] = [f'Spec file does not exist: {spec_path}']\n    outputs['warnings'] = []\n    outputs['score'] = 0\n    outputs['node_id'] = node_id\n    exit()\n\ncontent = spec_path.read_text()\n\nerrors = []\nwarnings = []\nscore = 100\n\n# Required sections (each worth 15 points)\nrequired_sections = [\n    (r'##\\s*1\\.\\s*Purpose', 'Missing \"1. Purpose\" section'),\n    (r'##\\s*2\\.\\s*Dependencies\\s*(&|and)\\s*Triggers', 'Missing \"2. Dependencies & Triggers\" section'),\n    (r'##\\s*3\\.\\s*Interfaces', 'Missing \"3. Interfaces\" section'),\n    (r'##\\s*4\\.\\s*Core\\s*Logic', 'Missing \"4. Core Logic\" section'),\n    (r'##\\s*6\\.\\s*Error\\s*Handling', 'Missing \"6. Error Handling\" section'),\n    (r'##\\s*7\\.\\s*ARC\\s*Verification\\s*Criteria', 'Missing \"7. ARC Verification Criteria\" section')\n]\n\nfor pattern, error_msg in required_sections:\n    if not re.search(pattern, content, re.IGNORECASE):\n        errors.append(error_msg)\n        score -= 15\n\n# Check for placeholder text (critical: -20 points)\nplaceholder_patterns = [\n    (r'\\[Agent:', 'Contains [Agent: placeholder'),\n    (r'\\[TODO', 'Contains [TODO] placeholder'),\n    (r'\\[FILL', 'Contains [FILL] placeholder'),\n    (r'\\[TBD\\]', 'Contains [TBD] placeholder'),\n    (r'\\[INSERT', 'Contains [INSERT] placeholder')\n]\n\nfor pattern, msg in placeholder_patterns:\n    if re.search(pattern, content, re.IGNORECASE):\n        errors.append(msg)\n        score -= 20\n        break\n\n# Check ARC criteria are testable (each missing type costs 10 points)\narc_section = re.search(r'##\\s*7\\.\\s*ARC\\s*Verification\\s*Criteria(.+?)(?=##|$)', content, re.DOTALL | re.IGNORECASE)\nif arc_section:\n    arc_content = arc_section.group(1)\n    \n    # Must have at least 3 criteria types\n    has_functional = bool(re.search(r'\\*\\*Functional\\s*Criteria', arc_content, re.IGNORECASE))\n    has_validation = bool(re.search(r'\\*\\*Input\\s*Validation', arc_content, re.IGNORECASE))\n    has_error = bool(re.search(r'\\*\\*Error\\s*Handling', arc_content, re.IGNORECASE))\n    \n    if not has_functional:\n        warnings.append('ARC section missing \"Functional Criteria\" subsection')\n        score -= 10\n    if not has_validation:\n        warnings.append('ARC section missing \"Input Validation Criteria\" subsection')\n        score -= 10\n    if not has_error:\n        warnings.append('ARC section missing \"Error Handling Criteria\" subsection')\n        score -= 10\n    \n    # Check for testable criteria format: ARC_XXX_01:\n    criteria_count = len(re.findall(r'ARC_[A-Z]+_\\d+:', arc_content))\n    if criteria_count < 3:\n        errors.append(f'Only {criteria_count} testable ARC criteria found (minimum 3 required with format ARC_XXX_01:)')\n        score -= 15\nelse:\n    errors.append('ARC Verification Criteria section is empty or malformed')\n    score -= 20\n\n# Check Version and Date fields present\nif not re.search(r'\\*\\*Version:\\*\\*', content):\n    warnings.append('Missing \"**Version:**\" field in header')\n    score -= 5\nif not re.search(r'\\*\\*Date:\\*\\*', content):\n    warnings.append('Missing \"**Date:**\" field in header')\n    score -= 5\n\n# Check for minimum content length in key sections\nif len(content) < 500:\n    warnings.append('Spec appears incomplete (less than 500 characters total)')\n    score -= 10\n\n# Calculate final validation\noutputs['valid'] = (score >= 70 and len(errors) == 0)\noutputs['score'] = max(0, score)\noutputs['errors'] = errors\noutputs['warnings'] = warnings\noutputs['node_id'] = node_id\noutputs['spec_path'] = str(spec_path)"
    }
  ]
}
