{
  "name": "tracker-update",
  "version": "0.1.0",
  "description": "Applies validated updates to knowzcode/knowzcode_tracker.md while preserving table structure.",
  "parameters": [
    {
      "name": "updates",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "node_id": {"type": "string"},
          "status": {"type": "string"},
          "workgroup_id": {"type": "string"},
          "notes": {"type": "string"}
        },
        "required": ["node_id"]
      },
      "required": true
    }
  ],
  "actions": [
    {
      "type": "python",
      "code": "from pathlib import Path\npath = Path('knowzcode/knowzcode_tracker.md')\ntext = path.read_text()\nlines = text.splitlines()\nheader_idx = next(i for i, line in enumerate(lines) if line.startswith('| Status |'))\ntable = lines[header_idx:]\nrows = [line for line in table if line.startswith('|')]\nupdates = {u['node_id']: u for u in inputs['updates']}\nnew_rows = []\nfor row in rows:\n    parts = [p.strip() for p in row.strip('|').split('|')]\n    if not parts or parts[2] == 'Node ID':\n        new_rows.append(row)\n        continue\n    node_id = parts[2].strip('`')\n    if node_id in updates:\n        upd = updates[node_id]\n        status = upd.get('status', parts[0].strip())\n        workgroup = upd.get('workgroup_id', parts[1].strip())\n        notes = upd.get('notes', parts[8].strip())\n        new_row = f\"| {status} | {workgroup} | `{node_id}` | {parts[3]} | {parts[4]} | {parts[5]} | {parts[6]} | {parts[7]} | {notes} |\"\n        new_rows.append(new_row)\n        updates.pop(node_id)\n    else:\n        new_rows.append(row)\nif updates:\n    missing = ', '.join(sorted(updates.keys()))\n    raise ValueError(f\"NodeIDs {missing} not found in tracker table\")\nlines[header_idx:] = new_rows + lines[header_idx + len(rows):]\npath.write_text('\\n'.join(lines) + '\\n')"
    }
  ]
}
