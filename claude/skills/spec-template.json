{
  "name": "spec-template",
  "version": "0.1.0",
  "description": "Seeds or repairs KCv2.0 spec files with the mandated template.",
  "parameters": [
    {"name": "node_id", "type": "string", "required": true},
    {"name": "label", "type": "string", "required": true},
    {"name": "classification", "type": "string", "required": true}
  ],
  "actions": [
    {
      "type": "python",
      "code": "from pathlib import Path\nfrom datetime import datetime\nnode_id = inputs['node_id']\nlabel = inputs['label']\nclassification = inputs['classification']\npath = Path('knowzcode/specs') / f'{node_id}.md'\nnow = datetime.utcnow().strftime('%Y-%m-%d %H:%M:%SZ')\ntemplate_lines = [\n    f'# Node Specification: {node_id} - {label}',\n    '',\n    '**Version:** 1.0',\n    f'**Date:** {now}',\n    '**Author:** AI-Agent (Draft)',\n    f'**Classification:** {classification}',\n    '',\n    '## 1. Purpose',\n    '* **Goal:** [Describe primary objective]',\n    '',\n    '## 2. Dependencies & Triggers',\n    '* **Prerequisite NodeIDs:** [List]',\n    '* **Input Data/State:** [Describe]',\n    '',\n    '## 3. Interfaces',\n    '* **Outputs / Results:** [Describe]',\n    '* **External Interfaces / APIs Called (If any):** [List]',\n    '',\n    '## 4. Core Logic & Processing Steps',\n    '1. [Step 1]',\n    '2. [Step 2]',\n    '',\n    '## 5. Data Structures',\n    '* **Primary Models / Tables:** [List]',\n    '* **Key Fields:** [List]',\n    '',\n    '## 6. ARC Verification Criteria',\n    '- [ ] Functional requirements satisfied',\n    '- [ ] Error handling verified',\n    '- [ ] Tests implemented/passed',\n    '- [ ] Performance considerations reviewed',\n    '- [ ] Security implications addressed',\n    '',\n    '## 7. Technical Debt',\n    '* [Document outstanding work or leave \'None\']',\n    ''\n]\ntemplate = '\\n'.join(template_lines)\nif not path.exists():\n    path.write_text(template + '\\n')\n    outputs['created'] = True\nelse:\n    text = path.read_text()\n    required_sections = ['## 1. Purpose', '## 2. Dependencies & Triggers', '## 3. Interfaces', '## 4. Core Logic & Processing Steps', '## 5. Data Structures', '## 6. ARC Verification Criteria', '## 7. Technical Debt']\n    if all(section in text for section in required_sections):\n        outputs['created'] = False\n    else:\n        merged = text.strip() + '\\n\\n<!-- Template sections restored -->\\n' + template + '\\n'\n        path.write_text(merged)\n        outputs['created'] = False"
    }
  ]
}
