{
  "name": "alias-resolver",
  "version": "0.1.0",
  "description": "Resolves friendly natural-language aliases to KnowzCode canonical values (phase, audit, plan, workgroup_type).",
  "parameters": [
    {"name": "domain", "type": "string", "required": true},
    {"name": "text", "type": "string", "required": false}
  ],
  "actions": [
    {
      "type": "python",
      "code": "domain = (inputs.get('domain') or '').strip().lower()\ntext = (inputs.get('text') or '').strip().lower()\nresult = {'value': None}\nphase_map = {\n    '1a': {'subagent': 'impact-analyst', 'prompt': 'knowzcode/prompts/KCv2.0__[LOOP_1A]__Propose_Change_Set.md'},\n    '1b': {'subagent': 'spec-chief', 'prompt': 'knowzcode/prompts/KCv2.0__[LOOP_1B]__Draft_Specs.md'},\n    '2a': {'subagent': 'implementation-lead', 'prompt': 'knowzcode/prompts/KCv2.0__[LOOP_2A]__Implement_Change_Set.md'},\n    '2b': {'subagent': 'arc-auditor', 'prompt': 'knowzcode/prompts/KCv2.0__[LOOP_2B]__Verify_Implementation.md'},\n    '3': {'subagent': 'finalization-steward', 'prompt': 'knowzcode/prompts/KCv2.0__[LOOP_3]__Finalize_And_Commit.md'}\n}\nphase_synonyms = {\n    '1a': ['1a','loop 1a','analyze','analysis','impact','scope','change set','proposal','analyser','impact analysis'],\n    '1b': ['1b','loop 1b','spec','specs','draft','design','blueprint','documentation'],\n    '2a': ['2a','loop 2a','implement','implementation','build','code','develop','developing','execution'],\n    '2b': ['2b','loop 2b','verify','verification','audit','test','qa','review'],\n    '3': ['3','loop 3','final','finalize','finalization','finalise','commit','wrap up','document','close']\n}\naudit_map = {\n    'spec': 'knowzcode/prompts/KCv2.0__Spec_Verification_Checkpoint.md',\n    'implementation': 'knowzcode/prompts/KCv2.0__[LOOP_2B]__Verify_Implementation.md',\n    'architecture': 'knowzcode/prompts/KCv2.0__Architecture_Health_Review.md',\n    'security': 'knowzcode/prompts/KCv2.0__Advanced_Security_Audit.md',\n    'integration': 'knowzcode/prompts/KCv2.0__Holistic_Integration_Audit.md'\n}\naudit_synonyms = {\n    'spec': ['spec','specs','specification','specification audit','checkpoint'],\n    'implementation': ['implementation','implementation review','code','verify implementation','loop 2b','build audit'],\n    'architecture': ['architecture','arch','diagram','flowchart','structure','architecture review','arch review'],\n    'security': ['security','sec','owasp','vulnerability','penetration','security review','security audit'],\n    'integration': ['integration','holistic','system','end to end','end-to-end','e2e']\n}\nplan_map = {\n    'strategic-blueprint': 'knowzcode/prompts/KCv2.0__Strategic_Blueprint_Designer.md',\n    'feature-ideas': 'knowzcode/prompts/KCv2.0__Feature_Idea_Breakdown.md',\n    'pre-flight': 'knowzcode/prompts/KCv2.0__Pre_Flight_Feature_Analysis.md',\n    'project-generator': 'knowzcode/prompts/KCv2.0__Project_Generator.md',\n    'major-feature': 'knowzcode/prompts/KCv2.0__Major_Mid_Project_Feature_Addition.md',\n    'expansion': 'knowzcode/prompts/KCv2.0__Expand_Completed_Project.md'\n}\nplan_synonyms = {\n    'strategic-blueprint': ['strategy','strategic','blueprint','vision','planning'],\n    'feature-ideas': ['feature ideas','idea','brainstorm','backlog','ideation'],\n    'pre-flight': ['preflight','pre-flight','pre flight','analysis','feasibility'],\n    'project-generator': ['project overview','project plan','generator','project','overview'],\n    'major-feature': ['major feature','mid project','large feature','expansion plan'],\n    'expansion': ['expand','next version','roadmap','v1.1','expansion']\n}\nworkgroup_map = {'feat': 'feat','feature': 'feat','feature request': 'feat','new feature': 'feat','fix': 'fix','bug': 'fix','bugfix': 'fix','refactor': 'refactor','cleanup': 'refactor','issue': 'issue','incident': 'issue'}\nif domain == 'phase':\n    if not text:\n        key = '1a'\n    else:\n        key = None\n        for canonical, synonyms in phase_synonyms.items():\n            if text == canonical or text in synonyms or any(s in text for s in synonyms):\n                key = canonical\n                break\n        if key is None:\n            # attempt direct mapping like '1b'
            for canonical in phase_map.keys():
                if text.replace(' ','') == canonical:
                    key = canonical
                    break
        if key is None:
            key = '1a'
    data = phase_map[key]
    result['value'] = key.upper()
    result['prompt'] = data['prompt']
    result['subagent'] = data['subagent']
    result['requires_workgroup'] = data['subagent'] != 'impact-analyst'
elif domain == 'audit':
    if not text:
        key = 'spec'
    else:
        key = None
        for canonical, synonyms in audit_synonyms.items():
            if text == canonical or text in synonyms or any(s in text for s in synonyms):
                key = canonical
                break
        if key is None and text in audit_map:
            key = text
        if key is None:
            key = 'spec'
    result['value'] = key
    result['prompt'] = audit_map[key]
elif domain == 'plan':
    if not text:
        key = 'strategic-blueprint'
    else:
        key = None
        for canonical, synonyms in plan_synonyms.items():
            if text == canonical or text in synonyms or any(s in text for s in synonyms):
                key = canonical
                break
        if key is None and text in plan_map:
            key = text
        if key is None:
            key = 'strategic-blueprint'
    result['value'] = key
    result['prompt'] = plan_map[key]
elif domain == 'workgroup_type':
    if not text:
        value = 'feat'
    else:
        value = None
        for key, mapped in workgroup_map.items():
            if text == key or key in text:
                value = mapped
                break
        if value is None:
            value = workgroup_map.get(text, 'feat')
    result['value'] = value
else:
    result['value'] = text or ''
outputs.update(result)
"
    }
  ]
}
