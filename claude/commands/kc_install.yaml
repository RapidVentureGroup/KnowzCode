# Claude Command: /kc-install
name: kc-install
version: 1.0.0
description: "Installs KnowzCode automation system by copying claude/ template to .claude/ and configuring hooks"
slash_command: true

inputs:
  - name: force
    type: boolean
    required: false
    description: "Force reinstall even if .claude/ already exists"

execution:
  steps:
    - skill: check-installation-status

    - when:
        condition: "{{ skills['check-installation-status'].already_installed and not inputs.force }}"
        render_markdown:
          template: |
            ‚ö†Ô∏è **KnowzCode is already installed** at `.claude/`

            To reinstall: `/kc-install force=true`

            **Current installation:**
            - Commands: {{ skills['check-installation-status'].commands_count }}
            - Skills: {{ skills['check-installation-status'].skills_count }}
            - Subagents: {{ skills['check-installation-status'].subagents_count }}
            - Hooks: {{ skills['check-installation-status'].hooks_count }}
            {% if skills['check-installation-status'].settings_exists %}
            - Settings: ‚úÖ Configured
            {% else %}
            - Settings: ‚ö†Ô∏è Missing (hooks won't work)
            {% endif %}

    - when:
        condition: "{{ not skills['check-installation-status'].already_installed or inputs.force }}"
        skill: install-knowzcode
        with:
          force: "{{ inputs.force }}"

    - when:
        condition: "{{ not skills['check-installation-status'].already_installed or inputs.force }}"
        skill: validate-installation

    - when:
        condition: "{{ not skills['check-installation-status'].already_installed or inputs.force }}"
        render_markdown:
          template: |
            # ‚úÖ KnowzCode Installation Complete!

            ## Installed Components

            - **Commands:** {{ skills['validate-installation'].commands_count }}
            - **Skills:** {{ skills['validate-installation'].skills_count }}
            - **Subagents:** {{ skills['validate-installation'].subagents_count }}
            - **Hooks:** {{ skills['validate-installation'].hooks_count }}

            {% if skills['install-knowzcode'].backup_created %}
            üì¶ **Backup:** Previous installation saved to `{{ skills['install-knowzcode'].backup_created }}`
            {% endif %}

            ## Hook Status

            {% if skills['validate-installation'].hooks_working %}
            ‚úÖ **All hooks are properly configured**

            Pre-command hooks will:
            - Validate environment setup before running commands
            - Confirm Change Sets are properly tracked
            - **Block Loop 2A if specs are incomplete** (automatic quality gate)

            Post-command hooks will:
            - Refresh cached context after updates
            - Report git status after finalization
            {% else %}
            ‚ö†Ô∏è **Hooks may need manual configuration**

            {% if skills['validate-installation'].errors %}
            **Errors:**
            {% for error in skills['validate-installation'].errors %}
            - {{ error }}
            {% endfor %}
            {% endif %}
            {% endif %}

            {% if skills['validate-installation'].warnings %}
            ## Warnings

            {% for warning in skills['validate-installation'].warnings %}
            - ‚ö†Ô∏è {{ warning }}
            {% endfor %}
            {% endif %}

            ## Next Steps

            1. **Complete environment setup:**
               Edit `knowzcode/environment_context.md` with your project's commands

            2. **Run post-installation audit:**
               ```
               knowzcode/prompts/ND__Post_Installation_Audit.md
               ```

            3. **Start your first WorkGroup:**
               ```
               /kc
               ```
               or
               ```
               /kc-step phase=1A
               ```

            4. **Test the spec validation hook:**
               - Create a WorkGroup with `/kc-step phase=1A`
               - Draft specs with `/kc-step phase=1B`
               - Try to implement with `/kc-step phase=2A`
               - The validation hook will automatically check specs before allowing implementation!

            ## Available Commands

            - `/kc` - Quick start a new Change Set
            - `/kc-step` - Run specific loop phases (1A, 1B, 2A, 2B, 3)
            - `/kc-audit` - Run quality audits (spec, implementation, architecture, security)
            - `/kc-plan` - Strategic planning workflows
            - `/kc-microfix` - Quick fixes for minor issues

            ---

            **KnowzCode is ready to use!** üöÄ

post_hooks:
  - git-status
