{
  "name": "install-knowzcode",
  "version": "1.0.0",
  "description": "Copies KnowzCode template from claude/ to .claude/ and configures hooks in settings.json",

  "parameters": [
    {
      "name": "force",
      "type": "boolean",
      "required": false,
      "description": "Force reinstall even if .claude/ exists"
    }
  ],

  "actions": [
    {
      "type": "python",
      "code": "import shutil\nimport os\nimport json\nfrom pathlib import Path\nfrom datetime import datetime\n\n# Configuration\nsource_dir = Path('claude')\ntarget_dir = Path('.claude')\nforce = inputs.get('force', False)\n\n# Check if source exists\nif not source_dir.exists():\n    outputs['success'] = False\n    outputs['error'] = 'Template directory claude/ not found'\n    exit()\n\n# Check if target exists\nif target_dir.exists() and not force:\n    outputs['success'] = False\n    outputs['error'] = '.claude/ already exists. Use force=true to reinstall'\n    outputs['already_installed'] = True\n    exit()\n\n# Backup existing installation if force=true\nif target_dir.exists() and force:\n    backup_dir = Path('.claude.backup')\n    if backup_dir.exists():\n        shutil.rmtree(backup_dir)\n    shutil.copytree(target_dir, backup_dir)\n    outputs['backup_created'] = str(backup_dir)\n    shutil.rmtree(target_dir)\nelse:\n    outputs['backup_created'] = None\n\n# Create directory structure\ntarget_dir.mkdir(exist_ok=True)\n(target_dir / 'commands').mkdir(exist_ok=True)\n(target_dir / 'skills').mkdir(exist_ok=True)\n(target_dir / 'subagents').mkdir(exist_ok=True)\n(target_dir / 'hooks').mkdir(exist_ok=True)\n(target_dir / 'hooks' / 'pre-command').mkdir(exist_ok=True)\n(target_dir / 'hooks' / 'post-command').mkdir(exist_ok=True)\n\n# Copy all files (excluding .DS_Store)\ncopied_files = []\nskipped_files = []\n\nfor item in source_dir.rglob('*'):\n    if item.is_file():\n        # Skip .DS_Store files\n        if item.name == '.DS_Store':\n            skipped_files.append(str(item.relative_to(source_dir)))\n            continue\n            \n        relative_path = item.relative_to(source_dir)\n        target_path = target_dir / relative_path\n        target_path.parent.mkdir(parents=True, exist_ok=True)\n        shutil.copy2(item, target_path)\n        copied_files.append(str(relative_path))\n\n# Create settings.json with hook configuration\nsettings = {\n    'hooks': {\n        'pre-command': {\n            'kc-step': ['validate-environment', 'confirm-change-set', 'validate-specs'],\n            'kc': ['validate-environment'],\n            'kc-audit': ['validate-environment'],\n            'kc-plan': ['validate-environment']\n        },\n        'post-command': {\n            'kc-step': ['update-caches', 'git-status'],\n            'kc': ['update-caches']\n        }\n    },\n    'metadata': {\n        'installed_by': 'kc-install',\n        'template_version': '2.0.0',\n        'installation_date': datetime.now().isoformat()\n    }\n}\n\nsettings_path = target_dir / 'settings.json'\nwith open(settings_path, 'w') as f:\n    json.dump(settings, f, indent=2)\n\n# Count installed components\ncommands_count = len(list((target_dir / 'commands').glob('*.yaml')))\nskills_count = len(list((target_dir / 'skills').glob('*.json')))\nsubagents_count = len(list((target_dir / 'subagents').glob('*.yaml')))\npre_hooks = len(list((target_dir / 'hooks' / 'pre-command').glob('*.js')))\npost_hooks = len(list((target_dir / 'hooks' / 'post-command').glob('*.js')))\nhooks_count = pre_hooks + post_hooks\n\n# Output results\noutputs['success'] = True\noutputs['target_dir'] = str(target_dir)\noutputs['copied_files'] = len(copied_files)\noutputs['skipped_files'] = skipped_files\noutputs['commands_count'] = commands_count\noutputs['skills_count'] = skills_count\noutputs['subagents_count'] = subagents_count\noutputs['hooks_count'] = hooks_count\noutputs['settings_created'] = str(settings_path)\noutputs['message'] = f'Successfully installed {len(copied_files)} files to {target_dir}'"
    }
  ]
}
